<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script src="jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="app.css">
    <script async src="app.js"></script>
    <title>ESP32 Control Panel</title>
</head>

<body>
<div class="page">

    <!-- ===================== HERO ===================== -->
    <header class="hero">
        <div class="hero__text">
            <p class="eyebrow">ESP32</p>
            <h1>Control Center</h1>
            <p class="subtitle">Gestiona tu dispositivo, credenciales y horarios en un panel limpio inspirado en iOS.</p>
        </div>

        <div class="hero__badge">
            <div class="badge__label">Latest Firmware</div>
            <div class="badge__value" id="latest_firmware">--</div>
        </div>
    </header>


    <!-- ===================== MAIN GRID ===================== -->
    <main class="grid">


        <!-- ========== OTA UPDATE ========== -->
        <section class="card">
            <div class="card__header">
                <p class="eyebrow">OTA</p>
                <h2>ESP32 Firmware Update</h2>
            </div>

            <div class="card__content stack">
                <input type="file" id="selected_file" accept=".bin" onchange="getFileInfo()" hidden />

                <div class="actions">
                    <button class="btn ghost" onclick="document.getElementById('selected_file').click();">
                        Select File
                    </button>

                    <button class="btn primary" onclick="updateFirmware()">
                        Update Firmware
                    </button>
                </div>

                <div class="status" id="file_info"></div>
                <div class="status highlight" id="ota_update_status"></div>
            </div>
        </section>



        <!-- ========== WIFI SETTINGS ========== -->
        <section class="card">
            <div class="card__header">
                <p class="eyebrow">Conectividad</p>
                <h2>ESP32 WiFi Connect</h2>
            </div>

            <div class="card__content stack">
                <label class="field">
                    <span>SSID</span>
                    <input id="connect_ssid" type="text" maxlength="32" placeholder="Red WiFi">
                </label>

                <label class="field">
                    <span>Password</span>
                    <input id="connect_pass" type="password" maxlength="64" placeholder="Ingresa la clave">
                </label>

                <label class="checkbox">
                    <input type="checkbox" onclick="showPassword()">
                    <span>Mostrar password</span>
                </label>

                <div class="actions">
                    <button class="btn primary" onclick="checkCredentials()">Connect</button>
                    <button class="btn secondary" onclick="toogle_led()">Toggle LED</button>
                </div>

                <div class="status error" id="wifi_connect_credentials_errors"></div>
                <div class="status" id="wifi_connect_status"></div>
            </div>
        </section>



        <!-- ========== MANUAL MODE ========== -->
        <section class="card">
            <div class="card__header">
                <p class="eyebrow">Modo Manual</p>
                <h2>Control del ventilador</h2>
            </div>

            <div class="card__content stack">
                <label class="field">
                    <span>Velocidad del ventilador (PWM %)</span>
                    <input type="range" id="manual_pwm" min="0" max="100" value="0"
                           oninput="onManualSliderChange(this)">
                </label>

                <p class="status">
                    Valor seleccionado: <span id="manualPwmLabel">0%</span>
                </p>

                <div class="actions">
                    <button class="btn primary" onclick="sendManualPwm()">Aplicar</button>
                </div>

                <div class="status highlight" id="manual_pwm_status"></div>
            </div>
        </section>



        <!-- ========== AUTOMATIC MODE ========== -->
        <section class="card">
            <div class="card__header">
                <p class="eyebrow">Modo Automático</p>
                <h2>Control por temperatura</h2>
            </div>

            <div class="card__content stack">
                <div class="double">
                    <label class="field">
                        <span>T<sub>min</sub> (°C)</span>
                        <input id="auto_tmin" type="number" step="0.5" value="20">
                    </label>

                    <label class="field">
                        <span>T<sub>max</sub> (°C)</span>
                        <input id="auto_tmax" type="number" step="0.5" value="30">
                    </label>
                </div>

                <div class="actions">
                    <button class="btn primary" onclick="saveAutoConfig()">Guardar</button>
                </div>

                <div class="status highlight" id="auto_config_status"></div>
            </div>
        </section>



        <!-- ========== PROGRAMACIÓN NUEVA (3 SLOTS) ========== -->
        <section class="card">
            <div class="card__header">
                <p class="eyebrow">Programación</p>
                <h2>Configurar registro</h2>
            </div>

            <div class="card__content stack">

                <label class="field">
                    <span>Selecciona el registro</span>
                    <select id="prog_id">
                        <option value="1">Registro 1</option>
                        <option value="2">Registro 2</option>
                        <option value="3">Registro 3</option>
                    </select>
                </label>

                <label class="checkbox">
                    <input type="checkbox" id="prog_active">
                    <span>Registro activo</span>
                </label>

                <div class="double">
                    <label class="field"><span>Hora inicio</span>
                        <input type="number" id="prog_h_start" min="0" max="23" value="20">
                    </label>
                    <label class="field"><span>Minuto inicio</span>
                        <input type="number" id="prog_m_start" min="0" max="59" value="0">
                    </label>
                </div>

                <div class="double">
                    <label class="field"><span>Hora fin</span>
                        <input type="number" id="prog_h_end" min="0" max="23" value="21">
                    </label>
                    <label class="field"><span>Minuto fin</span>
                        <input type="number" id="prog_m_end" min="0" max="59" value="0">
                    </label>
                </div>

                <div class="double">
                    <label class="field"><span>T 0% PWM (°C)</span>
                        <input type="number" id="prog_t0" value="24">
                    </label>
                    <label class="field"><span>T 100% PWM (°C)</span>
                        <input type="number" id="prog_t100" value="28">
                    </label>
                </div>

                <div class="actions">
                    <button class="btn primary" onclick="saveProgramSlot()">Guardar registro</button>
                    <button class="btn secondary" onclick="loadProgramSlot()">Leer registro</button>
                    <button class="btn ghost" onclick="eraseProgramSlot()">Borrar registro</button>
                </div>

                <div class="status highlight" id="prog_status"></div>
            </div>
        </section>



        <!-- ========== SYSTEM STATUS ========== -->
        <section class="card">
            <div class="card__header">
                <p class="eyebrow">Estado</p>
                <h2>Estado del sistema</h2>
            </div>

            <div class="card__content reg-list">
                <div class="reg-row"><span>Temperatura</span><span id="status_temp">--</span></div>
                <div class="reg-row"><span>PIR</span><span id="status_pir">--</span></div>
                <div class="reg-row"><span>Modo actual</span><span id="status_mode">--</span></div>
                <div class="reg-row"><span>PWM actual</span><span id="status_pwm">--</span></div>
            </div>
        </section>


    </main>
</div>
</body>
</html>
